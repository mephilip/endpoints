!function($){function t(){h.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function a(t){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function e(t){d3.select(this).attr("cx",t.x=d3.event.x).attr("cy",t.y=d3.event.y)}function n(t){d3.select(this).classed("dragging",!1)}$(document).foundation();var s=600,o=500,r,c=d3.geo.albersUsa().scale(820).translate([s/2,o/2]),i=d3.geo.path().projection(c),d=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",t),l=d3.behavior.drag().origin(function(t){return t}).on("dragstart",a).on("drag",e).on("dragend",n),u=d3.select("#map").append("svg").attr("width",s).attr("height",o).call(d);u.append("rect").attr("class","background").attr("width",s).attr("height",o);var h=u.append("g");d3.json(Variables.theme_url+"/assets/json/us-copy.json",function(t){var a=topojson.feature(t,t.objects.states).features;d3.json("http://localhost:8888/auto-insurance/wp-json/wp/v2/data/",function(e){var n={},s={};e.forEach(function(t,a){n[t.id]=t.name,s[t.id]=t.data.state_name,console.log(t.data.state_name)}),h.append("g").attr("id","states").selectAll("path").data(a).enter().append("path").attr("d",i).attr("class","state").attr("name",function(t){return n[t.id]}).attr("shortname",function(t){return console.log(s[t.id]),s[t.id]}).on("click",function(){if(!d3.event.defaultPrevented){var t=$(this).attr("shortname"),a=$(this).attr("name");console.log(t+" : "+a),u.selectAll("path").attr("class","state"),$(this).attr("class","active-state");var e=$("#ajax-results");e.html(Variables.loading_image),$.ajax({type:"POST",dataType:"json",url:Variables.ajaxurl,data:{action:"ajax_results",state:t},success:function(t){var e=0,n=0,s=[];$.each(t,function(t,a){$.each(a,function(t,a){"annual_premium"==t&&(s.push(a),e++)})}),console.log(s),console.log(e),$.each(s,function(){n+=parseFloat(this)||0}),console.log(n);var o=Math.round(n/e);$("#city-state").html(a),$(".big-number").html("$"+o)},error:function(t){e.html("Something went wrong try again")}})}}),h.append("path").datum(topojson.mesh(t,t.objects.states,function(t,a){return t!==a})).attr("id","state-borders").attr("d",i)})})}(jQuery);